<!DOCTYPE html>
<html lang="en">
<head>
    <title>Edventures</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .lesson-container {
            border: 1px solid #ccc;
            margin-bottom: 10px;
            padding: 10px;
        }
        .form-container {
            margin-top: 20px;
        }
        .rating {
            direction: rtl;
        }
        .rating a {
            font-size: 1.5em;
            color: #aaa;
            text-decoration: none;
        }
        .rating a:hover,
        .rating a:hover ~ a,
        .rating a.active,
        .rating a.active ~ a {
            color: #fde16d;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="lessons.js"></script>
</head>
<body>
    <div id="app">
        <h1>Edventures</h1>
        <!-- Display List of Lessons -->
        <div v-if="showProduct">
            <!-- Sort Functionality -->
            <div>
                Sort by:
                <select v-model="sortAttribute">
                    <option value="">Select</option>
                    <option value="subject">Subject</option>
                    <option value="location">Location</option>
                    <option value="price">Price</option>
                    <option value="spaces">Spaces</option>
                </select>
                Order:
                <select v-model="sortOrder">
                    <option value="">Select</option>
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                </select>
                <!-- Search Functionality -->
                Search:
                <input v-model="searchQuery" placeholder="Search lessons..." />
            </div>
            <!-- Lessons List -->
            <div class="lesson-container" v-for="(lesson, index) in filteredAndSortedLessons">
                <!-- Lesson Details -->
                <h2>{{ lesson.subject }}</h2>
                <p>Location: {{ lesson.location }}</p>
                <p>Price: {{ lesson.price }}</p>
                <p>Spaces: {{ lesson.spaces }}</p>
                <!-- Add to Cart Functionality -->
                <button v-on:click="addToCart(lesson)" v-if="lesson.spaces > 0">
                    Add to cart
                </button>
                <p v-else>Oh no, we're all out of spaces at the moment. Please check back later.</p>
                <!-- Rating System -->
                <div class="rating">
                    <a href="#" v-on:click.prevent="rate(lesson, 5)" v-bind:class="{ active: lesson.rating >= 5 }">★</a>
                    <a href="#" v-on:click.prevent="rate(lesson, 4)" v-bind:class="{ active: lesson.rating >= 4 }">★</a>
                    <a href="#" v-on:click.prevent="rate(lesson, 3)" v-bind:class="{ active: lesson.rating >= 3 }">★</a>
                    <a href="#" v-on:click.prevent="rate(lesson, 2)" v-bind:class="{ active: lesson.rating >= 2 }">★</a>
                    <a href="#" v-on:click.prevent="rate(lesson, 1)" v-bind:class="{ active: lesson.rating >= 1 }">★</a>
                </div>
            </div>
        </div>
        <!-- Shopping Cart and Checkout Functionality -->
        <div v-else>
            <!-- Shopping Cart -->
            <div class="cart-item" v-for="(lessonId, index) in cart">
                <div v-if="lesson = lessons.find(lesson => lesson.id === lessonId)">
                    <!-- Lesson Details -->
                    <h2>{{ lesson.subject }}</h2>
                    <p>Location: {{ lesson.location }}</p>
                    <p>Price: {{ lesson.price }}</p>
                    <!-- Remove from Cart Functionality -->
                    <button v-on:click="removeFromCart(lessonId)">
                        Remove from cart
                    </button>
                </div>
            </div>
            <!-- Checkout Form -->
            <div class="form-container">
                <h2>Checkout</h2>
                <p><strong>Name:</strong> <input v-model.trim="order.name" /></p>
                <p><strong>Phone Number:</strong> <input v-model.trim="order.phone" /></p>
                <button v-show="isValidName && isValidPhone" v-on:click="submitOrder">
                    Place Order
                </button>
            </div>
        </div>
        <!-- Checkout Button -->
        <button v-on:click="showProduct = !showProduct">
            <i class="fas fa-shopping-cart"></i> Checkout ({{ cart.length }})
        </button>
    </div>
    <script type="text/javascript">
        let app = new Vue({
            el: '#app',
            data: {
                showProduct: true,
                order: {
                    name: '',
                    phone: ''
                },
                lessons: lessons,
                cart: [],
                sortAttribute: '',
                sortOrder: '',
                searchQuery: ''
            },
            computed: {
                isValidName: function () {
                    return /^[A-Za-z]*$/.test(this.order.name);
                },
                isValidPhone: function () {
                    return /^[0-9]*$/.test(this.order.phone);
                },
                filteredAndSortedLessons: function () {
                    let lessonsArray = this.lessons;
                    if (this.searchQuery) {
                        let lowerCaseQuery = this.searchQuery.toLowerCase();
                        lessonsArray = lessonsArray.filter(lesson => lesson.subject.toLowerCase().includes(lowerCaseQuery) || lesson.location.toLowerCase().includes(lowerCaseQuery));
                    }
                    if (this.sortAttribute) {
                        if (this.sortOrder === 'asc') {
                            return lessonsArray.sort((a, b) => a[this.sortAttribute] > b[this.sortAttribute] ? 1 : -1);
                        } else if (this.sortOrder === 'desc') {
                            return lessonsArray.sort((a, b) => a[this.sortAttribute] > b[this.sortAttribute] ? -1 : 1);
                        }
                    }
                    return lessonsArray;
                }
            },
            methods: {
                addToCart: function (lesson) {
                    this.cart.push(lesson.id);
                    lesson.spaces--;
                },
                removeFromCart: function (lessonId) {
                    const index = this.cart.indexOf(lessonId);
                    if (index > -1) {
                        this.cart.splice(index, 1);
                        this.lessons.find(lesson => lesson.id === lessonId).spaces++;
                    }
                },
                submitOrder: function () {
                    if (this.isValidName && this.isValidPhone) {
                        alert('Order submitted!');
                        this.cart = [];
                        for (let lesson of this.lessons) {
                            lesson.spaces = 5;
                        }
                        this.showProduct = true;
                        this.order = {
                            name: '',
                            phone: ''
                        };
                    }
                },
                rate: function (lesson, rating) {
                    lesson.rating = rating;
                }
            }
        });
    </script>
</body>
</html>
